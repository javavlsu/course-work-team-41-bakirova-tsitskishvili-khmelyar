<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Главная страница</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <div class="dashboard-content-wrapper">

        <!-- Блок объявлений -->
        <div class="announcements-block">
            <div class="announcements-header">
                <h3 class="announcements-title">Объявления</h3>
                <button th:if="${isTeacher}"
                        class="announcements-add-button"
                        id="openAnnouncementModal">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="announcements-list">
                <div th:if="${announcements != null and !announcements.empty}">
                    <div th:each="announcement : ${announcements}"
                         class="announcement-item">
                        <div class="announcement-meta">
                            <h4 class="announcement-heading" th:text="${announcement.title}"></h4>
                            <span class="announcement-date"
                                  th:text="${#temporals.format(announcement.createdAt, 'dd.MM.yyyy HH:mm')}"></span>
                        </div>
                        <p class="announcement-text" th:text="${announcement.text}"></p>
                    </div>
                </div>
                <div th:if="${announcements == null or announcements.empty}"
                     class="announcement-item" style="border: none; background: none; text-align: center;">
                    <p class="text-gray-500">Объявлений пока нет.</p>
                </div>
            </div>
        </div>

        <!-- Блок информации о школе -->
        <div class="school-info-block">
            <div class="info-header-section">
                <center><h1 class="school-info-heading">Школа «Вектор»: где каждый ребёнок находит свой путь</h1></center>
                <div class="info-hero-image-container">
                    <center><img src="/img/school.png"
                                 alt="Современное здание школы «Вектор»"
                                 style="width: 50%; height: auto; display: block;"></center>
                </div>
            </div>

            <div class="info-text-content">
                <p class="lead-text">
                    Мы — современная школа «Вектор». Здесь мы верим, что у каждого ребёнка
                    есть свой уникальный талант и направление роста. Наша задача — не просто
                    дать знания, а помочь каждому ученику построить свой маршрут к успеху и
                    найти дело по душе.
                </p>

                <h3 class="info-section-title">Что делает «Вектор» особенным?</h3>

                <ul class="info-feature-list">
                    <li><strong class="text-primary-color">Проекты вместо зубрёжки:</strong> Мы учимся, решая реальные задачи. Создание собственного блога, экологический эксперимент или мини-стартап — вот наши уроки.</li>
                    <li><strong class="text-primary-color">Выбор и ответственность:</strong> С 7 класса ученики могут выбирать часть предметов и элективов, составляя свою учебную программу.</li>
                    <li><strong class="text-primary-color">Атмосфера доверия:</strong> У нас уютно и безопасно. Каждый голос важен. Наши психологи и наставники всегда готовы поддержать.</li>
                </ul>

                <h3 class="info-section-title">Наши принципы:</h3>

                <ul class="info-principle-list">
                    <li>✔ Интерес к познанию — главный двигатель.</li>
                    <li>✔ У нас современная и дружная команда преподавателей.</li>
                    <li>✔ Главное в жизни не оценки, а полученный опыт, для того, чтоб построить себя.</li>
                    <li>✔ Сотрудничество, а не конкуренция — работаем в командах.</li>
                    <li>✔ Связь с жизнью — приглашаем экспертов, ходим на экскурсии в компании и лаборатории.</li>
                </ul>

                <h3 class="info-section-title">Мы готовим не к экзаменам, а к будущему.</h3>
                <p>
                    Наши выпускники — это не просто отличники. Это аналитики, способные работать с информацией, творцы, умеющие генерировать идеи, и ответственные граждане, готовые менять мир к лучшему.
                </p>

                <p class="final-call-to-action">
                    Учась у нас вы почувствуете атмосферу «Вектора»!
                </p>
            </div>

            <div class="info-contacts-footer">
                <h4 class="contacts-title">Контакты:</h4>
                <ul class="contacts-list">
                    <li><i class="fas fa-map-marker-alt contact-icon"></i> Адрес: г. Волжинск, ул. Перспективная, д. 9</li>
                    <li><i class="fas fa-phone contact-icon"></i> Телефон: +7 (999) 979-79-79</li>
                    <li><i class="fas fa-envelope contact-icon"></i> E-mail: <a href="mailto:vector-school@yandex.ru" class="contact-link">vector-school@yandex.ru</a></li>
                </ul>
            </div>
        </div>

    </div>
</div>

<!-- Модальное окно -->
<div id="announcementModal" class="modal-overlay">
    <div class="modal-content">
        <h3 class="modal-header">Новое объявление</h3>
        <form id="announcementForm" class="announcement-form"
              th:action="@{/create-announcement}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <input type="text" id="announcementTitle" name="title"
                   class="form-input-field" placeholder="Заголовок объявления" required>

            <textarea id="announcementText" name="text" class="form-textarea-field"
                      placeholder="Текст объявления" rows="10" required></textarea>

            <div class="modal-actions">
                <button type="button" id="cancelAnnouncementModal" class="btn btn-secondary">Отмена</button>
                <button type="submit" class="btn btn-primary-modal">Опубликовать</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('announcementModal');
        const openBtn = document.getElementById('openAnnouncementModal');
        const cancelBtn = document.getElementById('cancelAnnouncementModal');
        const form = document.getElementById('announcementForm');

        function showModal() {
            if (modal) modal.style.display = 'flex';
        }
        function hideModal() {
            if (modal) modal.style.display = 'none';
        }

        if (openBtn) {
            openBtn.addEventListener('click', showModal);
        }

        if (cancelBtn) {
            cancelBtn.addEventListener('click', hideModal);
        }

        if (modal) {
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    hideModal();
                }
            });
        }

        if (form) {
            form.addEventListener('submit', async function(event) {
                event.preventDefault();

                const formData = new FormData(form);
                const actionUrl = form.getAttribute('action');
                const submitButton = form.querySelector('button[type="submit"]');
                const originalText = submitButton.textContent;

                submitButton.textContent = 'Публикуется...';
                submitButton.disabled = true;

                try {
                    const response = await fetch(actionUrl, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            alert(result.message || 'Объявление успешно опубликовано');
                            hideModal();
                            form.reset();
                            window.location.reload();
                        } else {
                            alert('Ошибка: ' + (result.message || 'Не удалось опубликовать объявление'));
                        }
                    } else {
                        alert('Ошибка сервера: ' + response.status);
                    }
                } catch (error) {
                    console.error('Ошибка AJAX:', error);
                    alert('Ошибка сети или сервера.');
                } finally {
                    submitButton.textContent = originalText;
                    submitButton.disabled = false;
                }
            });
        }
    });
</script>
</body>
</html>